<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Achri - Algerian Shop</title>
    
    <!-- Scripts -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700;900&display=swap');
        * { font-family: 'Cairo', sans-serif; transition: all 0.2s ease-in-out; -webkit-tap-highlight-color: transparent; }
        .hidden { display: none !important; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        
        /* Admin Hold Animation */
        #logo { user-select: none; -webkit-user-select: none; touch-action: none; }
        .hold-active { transform: scale(0.9); color: #ea580c; }
        #hold-progress { height: 4px; background: #ea580c; width: 0%; position: absolute; bottom: 0; left: 0; transition: width 3s linear; }

        .loader { border: 3px solid #f3f3f3; border-top: 3px solid #ea580c; border-radius: 50%; width: 24px; height: 24px; animation: spin 1s linear infinite; display: inline-block; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body class="bg-gray-50 text-gray-900">

    <!-- Navbar -->
    <nav class="bg-white border-b sticky top-0 z-50 px-4 py-3 shadow-sm flex justify-between items-center overflow-hidden">
        <div id="logo-container" class="relative pb-1">
            <div id="logo" class="text-2xl font-black text-orange-600 cursor-pointer">Achri</div>
            <div id="hold-progress"></div>
        </div>
        
        <div class="flex items-center gap-3">
            <button onclick="toggleLang()" id="lang-btn" class="bg-gray-100 px-3 py-1 rounded-full text-xs font-bold border">English</button>
            <div onclick="showView('cart')" class="relative cursor-pointer p-2">
                <i data-lucide="shopping-cart"></i>
                <span id="cart-count" class="absolute -top-1 -right-1 bg-red-600 text-white text-[10px] w-5 h-5 flex items-center justify-center rounded-full">0</span>
            </div>
            <button id="admin-nav-btn" onclick="showView('admin')" class="hidden border-2 border-orange-600 text-orange-600 px-2 py-1 rounded-lg text-xs font-bold">Admin</button>
        </div>
    </nav>

    <main class="max-w-6xl mx-auto p-4">
        
        <!-- HOME VIEW -->
        <div id="view-home" class="view">
            <div id="category-bar" class="flex gap-2 overflow-x-auto pb-4 no-scrollbar mb-2"></div>
            <div id="product-grid" class="grid grid-cols-2 md:grid-cols-4 gap-4"></div>
        </div>

        <!-- CART VIEW -->
        <div id="view-cart" class="view hidden">
            <div class="grid md:grid-cols-2 gap-8">
                <div class="bg-white p-6 rounded-2xl shadow-sm border">
                    <h2 class="text-xl font-bold mb-4" id="t-cart">Ø³Ù„Ø© Ø§Ù„ØªØ³ÙˆÙ‚</h2>
                    <div id="cart-items" class="divide-y mb-4"></div>
                    <div class="border-t pt-4 space-y-2 font-bold">
                        <div class="flex justify-between text-gray-500"><span id="t-delivery">Ø§Ù„ØªÙˆØµÙŠÙ„</span><span id="shipping-price">0 DA</span></div>
                        <div class="flex justify-between text-xl text-orange-600"><span id="t-total">Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</span><span id="total-price">0 DA</span></div>
                    </div>
                </div>
                <div class="bg-white p-6 rounded-2xl shadow-sm border space-y-4">
                    <input id="form-name" class="w-full border p-3 rounded-xl" placeholder="Ø§Ù„Ø§Ø³Ù… ÙˆØ§Ù„Ù„Ù‚Ø¨">
                    <input id="form-phone" class="w-full border p-3 rounded-xl" placeholder="Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ">
                    <select id="form-wilaya" class="w-full border p-3 rounded-xl" onchange="updatePrices()"></select>
                    <input id="form-address" class="w-full border p-3 rounded-xl" placeholder="Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ÙƒØ§Ù…Ù„">
                    <div class="bg-gray-100 p-2 rounded-xl flex gap-4 text-sm font-bold">
                        <label class="flex-1 text-center cursor-pointer"><input type="radio" name="del-type" value="home" checked onchange="updatePrices()"> Ù…Ù†Ø²Ù„</label>
                        <label class="flex-1 text-center cursor-pointer"><input type="radio" name="del-type" value="desk" onchange="updatePrices()"> Ù…ÙƒØªØ¨</label>
                    </div>
                    <button onclick="submitOrder()" class="w-full bg-orange-600 text-white py-4 rounded-xl font-bold">Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨</button>
                </div>
            </div>
        </div>

        <!-- ADMIN VIEW -->
        <div id="view-admin" class="view hidden space-y-6">
            <div class="bg-white p-6 rounded-2xl border max-w-lg mx-auto shadow-lg">
                <h2 class="text-xl font-bold mb-4 text-orange-600">Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬ Ø¬Ø¯ÙŠØ¯</h2>
                <div class="space-y-4">
                    <input id="p-name" class="w-full border p-3 rounded-xl outline-none" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬">
                    <input id="p-price" class="w-full border p-3 rounded-xl outline-none" type="number" placeholder="Ø§Ù„Ø³Ø¹Ø±">
                    <input id="p-cat" class="w-full border p-3 rounded-xl outline-none" placeholder="Ø§Ù„ØªØµÙ†ÙŠÙ">
                    <input id="p-imgs" type="file" multiple accept="image/*" class="w-full text-sm">
                    <button onclick="addProduct()" id="btn-save" class="w-full bg-blue-600 text-white py-3 rounded-xl font-bold flex justify-center items-center gap-2">
                        <span>Ø­ÙØ¸ Ø§Ù„Ù…Ù†ØªØ¬</span>
                        <div id="loader" class="loader hidden"></div>
                    </button>
                </div>
            </div>
            <div class="bg-white p-6 rounded-2xl border shadow-sm">
                <h2 class="text-xl font-bold mb-4">Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø£Ø®ÙŠØ±Ø©</h2>
                <div id="admin-orders" class="space-y-4"></div>
            </div>
        </div>
    </main>

    <!-- Admin Login Modal -->
    <div id="modal-login" class="fixed inset-0 bg-black/80 z-[60] flex items-center justify-center hidden p-4 backdrop-blur-sm">
        <div class="bg-white p-8 rounded-3xl w-full max-w-sm shadow-2xl">
            <h2 class="text-2xl font-black mb-6 text-center">Admin Access</h2>
            <input id="login-pass" type="password" class="w-full border-2 p-4 rounded-2xl mb-4 text-center text-xl tracking-widest outline-orange-500" placeholder="â€¢â€¢â€¢â€¢â€¢">
            <button onclick="handleLogin()" class="w-full bg-orange-600 text-white py-4 rounded-2xl font-black text-lg">Enter</button>
            <button onclick="closeLogin()" class="w-full text-gray-400 mt-4 text-sm">Cancel</button>
        </div>
    </div>

    <script>
        // --- CONFIG ---
        const firebaseConfig = {
            apiKey: "AIzaSyANZmMR3E5-QnkO-SgIY3yv5i2n7AciLkU",
            authDomain: "achri-822f1.firebaseapp.com",
            databaseURL: "https://achri-822f1-default-rtdb.europe-west1.firebasedatabase.app",
            projectId: "achri-822f1",
            storageBucket: "achri-822f1.firebasestorage.app",
            messagingSenderId: "1067421301667",
            appId: "1:1067421301667:web:e1a47b79e2911c6d17b816"
        };

        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        let allProducts = [];
        let cart = [];
        let lang = 'ar';
        let holdTimer;
        const wilayas = ["01 Adrar", "02 Chlef", "03 Laghouat", "04 Oum El Bouaghi", "05 Batna", "06 Bejaia", "07 Biskra", "08 Bechar", "09 Blida", "10 Bouira", "11 Tamanrasset", "12 Tebessa", "13 Tlemcen", "14 Tiaret", "15 Tizi Ouzou", "16 Alger", "17 Djelfa", "18 Jijel", "19 Setif", "20 Saida", "21 Skikda", "22 Sidi Bel Abbes", "23 Annaba", "24 Guelma", "25 Constantine", "26 Medea", "27 Mostaganem", "28 M'Sila", "29 Mascara", "30 Ouargla", "31 Oran", "32 El Bayadh", "33 Illizi", "34 Bordj Bou Arreridj", "35 Boumerdes", "36 El Tarf", "37 Tindouf", "38 Tissemsilt", "39 El Oued", "40 Khenchela", "41 Souk Ahras", "42 Tipaza", "43 Mila", "44 Ain Defla", "45 Naama", "46 Ain Temouchent", "47 Ghardaia", "48 Relizane", "49 El M'Ghair", "50 El Meniaa", "51 Ouled Djellal", "52 Bordj Baji Mokhtar", "53 Beni Abbes", "54 Timimoun", "55 Touggourt", "56 Djanet", "57 In Salah", "58 In Guezzam"];

        window.onload = () => {
            lucide.createIcons();
            initWilayas();
            loadProducts();
            setupSecretAdmin();
        };

        // --- SECRET ADMIN LOGIC (FIXED) ---
        function setupSecretAdmin() {
            const logo = document.getElementById('logo');
            const progress = document.getElementById('hold-progress');

            const startHold = (e) => {
                e.preventDefault(); // Prevents Context Menu
                logo.classList.add('hold-active');
                progress.style.width = '100%';
                holdTimer = setTimeout(() => {
                    document.getElementById('modal-login').classList.remove('hidden');
                    resetHold();
                }, 3000);
            };

            const resetHold = () => {
                clearTimeout(holdTimer);
                logo.classList.remove('hold-active');
                progress.style.transition = 'none';
                progress.style.width = '0%';
                setTimeout(() => progress.style.transition = 'width 3s linear', 10);
            };

            logo.addEventListener('mousedown', startHold);
            logo.addEventListener('touchstart', startHold);
            window.addEventListener('mouseup', resetHold);
            window.addEventListener('touchend', resetHold);
            logo.addEventListener('contextmenu', e => e.preventDefault());
        }

        function handleLogin() {
            const pass = document.getElementById('login-pass').value;
            if(pass === '12346') {
                document.getElementById('modal-login').classList.add('hidden');
                document.getElementById('admin-nav-btn').classList.remove('hidden');
                showView('admin');
            } else {
                alert("Incorrect Password!");
            }
        }
        
        function closeLogin() { document.getElementById('modal-login').classList.add('hidden'); }

        // --- DATABASE LOGIC ---
        function loadProducts() {
            db.ref('products').on('value', snap => {
                const data = snap.val();
                allProducts = data ? Object.keys(data).map(k => ({id:k, ...data[k]})) : [];
                renderProducts();
                renderCategories();
            });
        }

        function renderProducts(list = allProducts) {
            const grid = document.getElementById('product-grid');
            grid.innerHTML = list.map(p => `
                <div class="bg-white rounded-2xl border shadow-sm overflow-hidden">
                    <img src="${p.images[0]}" class="w-full aspect-square object-cover">
                    <div class="p-3">
                        <h3 class="font-bold text-sm truncate">${p.name}</h3>
                        <p class="text-orange-600 font-black">${p.price} DA</p>
                        <button onclick="addToCart('${p.id}')" class="w-full bg-orange-600 text-white text-xs font-bold py-2 rounded-lg mt-2">Ø¥Ø¶Ø§ÙØ© Ù„Ù„Ø³Ù„Ø©</button>
                    </div>
                </div>
            `).join('');
        }

        async function addProduct() {
            const name = document.getElementById('p-name').value;
            const price = document.getElementById('p-price').value;
            const cat = document.getElementById('p-cat').value;
            const files = document.getElementById('p-imgs').files;

            if(!name || !price || files.length === 0) return alert("Missing Info");

            const btn = document.getElementById('btn-save');
            const loader = document.getElementById('loader');
            btn.disabled = true; loader.classList.remove('hidden');

            const imgs = [];
            for(let f of files) {
                imgs.push(await compressImg(f));
            }

            await db.ref('products').push({ name, price, category: cat || 'General', images: imgs });
            alert("Product Saved!");
            location.reload();
        }

        function compressImg(file) {
            return new Promise(res => {
                const reader = new FileReader();
                reader.readAsDataURL(file);
                reader.onload = e => {
                    const img = new Image();
                    img.src = e.target.result;
                    img.onload = () => {
                        const canvas = document.createElement('canvas');
                        const ctx = canvas.getContext('2d');
                        canvas.width = 400;
                        canvas.height = img.height * (400 / img.width);
                        ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
                        res(canvas.toDataURL('image/jpeg', 0.7));
                    }
                }
            });
        }

        // --- ORDER LOGIC ---
        async function submitOrder() {
            const name = document.getElementById('form-name').value;
            const phone = document.getElementById('form-phone').value;
            if(!name || !phone || cart.length === 0) return alert("Fill all info");

            const total = document.getElementById('total-price').innerText;
            await db.ref('orders').push({
                customer: name, phone: phone, 
                wilaya: document.getElementById('form-wilaya').value,
                items: cart.map(i => i.name), total, date: new Date().toLocaleString()
            });
            alert("ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø·Ù„Ø¨Ùƒ Ø¨Ù†Ø¬Ø§Ø­! Ø§Ù„Ù…Ø¨Ù„Øº: " + total);
            cart = []; location.reload();
        }

        function loadOrders() {
            db.ref('orders').once('value', snap => {
                const data = snap.val();
                const list = data ? Object.values(data).reverse() : [];
                document.getElementById('admin-orders').innerHTML = list.map(o => `
                    <div class="p-3 border rounded-xl text-xs bg-gray-50">
                        <div class="flex justify-between font-bold text-orange-600"><span>${o.customer}</span><span>${o.total}</span></div>
                        <p>${o.phone} | ${o.wilaya}</p>
                        <p class="text-blue-600 font-bold mt-1">ğŸ“¦ ${o.items.join(', ')}</p>
                    </div>
                `).join('');
            });
        }

        // --- UI UTILS ---
        function showView(v) {
            document.querySelectorAll('.view').forEach(el => el.classList.add('hidden'));
            document.getElementById('view-' + v).classList.remove('hidden');
            if(v === 'admin') loadOrders();
        }

        function addToCart(id) {
            cart.push(allProducts.find(p => p.id === id));
            document.getElementById('cart-count').innerText = cart.length;
            renderCartUI();
        }

        function renderCartUI() {
            document.getElementById('cart-items').innerHTML = cart.map((p, i) => `
                <div class="flex justify-between py-2 text-sm"><span>${p.name}</span><b>${p.price} DA</b></div>
            `).join('');
            updatePrices();
        }

        function updatePrices() {
            const sub = cart.reduce((s, p) => s + parseInt(p.price), 0);
            const del = document.querySelector('input[name="del-type"]:checked').value === 'home' ? 600 : 400;
            document.getElementById('shipping-price').innerText = del + " DA";
            document.getElementById('total-price').innerText = (sub + del) + " DA";
        }

        function initWilayas() {
            document.getElementById('form-wilaya').innerHTML = wilayas.map(w => `<option>${w}</option>`).join('');
        }

        function renderCategories() {
            const cats = ['All', ...new Set(allProducts.map(p => p.category))];
            document.getElementById('category-bar').innerHTML = cats.map(c => `<button onclick="renderProducts(allProducts.filter(p => '${c}' === 'All' || p.category === '${c}'))" class="bg-white border px-4 py-1 rounded-full text-xs font-bold whitespace-nowrap shadow-sm">${c}</button>`).join('');
        }

        function toggleLang() {
            lang = lang === 'ar' ? 'en' : 'ar';
            document.dir = lang === 'ar' ? 'rtl' : 'ltr';
            document.getElementById('lang-btn').innerText = lang === 'ar' ? 'English' : 'Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©';
            document.getElementById('t-cart').innerText = lang === 'ar' ? 'Ø³Ù„Ø© Ø§Ù„ØªØ³ÙˆÙ‚' : 'Shopping Cart';
            document.getElementById('t-delivery').innerText = lang === 'ar' ? 'Ø§Ù„ØªÙˆØµÙŠÙ„' : 'Delivery';
            document.getElementById('t-total').innerText = lang === 'ar' ? 'Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ' : 'Total';
        }
    </script>
</body>
</html>