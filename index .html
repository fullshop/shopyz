<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Achri - Algerian Shop</title>
    
    <!-- Scripts -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700;900&display=swap');
        * { font-family: 'Cairo', sans-serif; transition: all 0.2s ease-in-out; -webkit-tap-highlight-color: transparent; }
        .hidden { display: none !important; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        
        #logo { user-select: none; -webkit-user-select: none; touch-action: none; position: relative; }
        .hold-active { transform: scale(0.9); color: #ea580c; }
        #hold-progress { height: 4px; background: #ea580c; width: 0%; position: absolute; bottom: 0; left: 0; transition: width 3s linear; }

        .loader { border: 3px solid #f3f3f3; border-top: 3px solid #ea580c; border-radius: 50%; width: 20px; height: 20px; animation: spin 1s linear infinite; display: inline-block; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        
        .product-card { cursor: pointer; position: relative; z-index: 10; }
        .product-card:active { transform: scale(0.96); }
        .liked { color: #ef4444 !important; fill: #ef4444; }
        
        /* Status Colors */
        .status-pending { background: #fef3c7; color: #d97706; }
        .status-delivered { background: #dcfce7; color: #16a34a; }
        .status-shipped { background: #dbeafe; color: #2563eb; }
    </style>
</head>
<body class="bg-gray-50 text-gray-900">

    <!-- Navbar -->
    <nav class="bg-white border-b sticky top-0 z-40 px-4 py-3 shadow-sm flex justify-between items-center">
        <div id="logo-container" class="relative pb-1">
            <div id="logo" class="text-2xl font-black text-orange-600">Achri</div>
            <div id="hold-progress"></div>
        </div>
        
        <div class="flex items-center gap-3">
            <button onclick="toggleLang()" id="lang-btn" class="bg-gray-100 px-3 py-1 rounded-full text-xs font-bold border">English</button>
            <div onclick="showView('cart')" class="relative cursor-pointer p-2">
                <i data-lucide="shopping-cart"></i>
                <span id="cart-count" class="absolute -top-1 -right-1 bg-red-600 text-white text-[10px] w-5 h-5 flex items-center justify-center rounded-full font-bold">0</span>
            </div>
            <button id="admin-nav-btn" onclick="showView('admin')" class="hidden border-2 border-orange-600 text-orange-600 px-2 py-1 rounded-lg text-xs font-bold">Admin</button>
        </div>
    </nav>

    <main class="max-w-6xl mx-auto p-4">
        
        <!-- HOME VIEW -->
        <div id="view-home" class="view">
            <div id="category-bar" class="flex gap-2 overflow-x-auto pb-4 no-scrollbar mb-2"></div>
            <div id="product-grid" class="grid grid-cols-2 md:grid-cols-4 gap-4"></div>
        </div>

        <!-- CART VIEW -->
        <div id="view-cart" class="view hidden">
            <div class="grid md:grid-cols-2 gap-8">
                <div class="bg-white p-6 rounded-2xl shadow-sm border">
                    <h2 class="text-xl font-bold mb-4" id="t-cart">Ø³Ù„Ø© Ø§Ù„ØªØ³ÙˆÙ‚</h2>
                    <div id="cart-items" class="divide-y mb-4"></div>
                    <div class="border-t pt-4 space-y-2 font-bold text-sm">
                        <div class="flex justify-between text-gray-500"><span>Ø§Ù„ØªÙˆØµÙŠÙ„</span><span id="shipping-price">0 DA</span></div>
                        <div class="flex justify-between text-xl text-orange-600"><span>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</span><span id="total-price">0 DA</span></div>
                    </div>
                </div>
                <div class="bg-white p-6 rounded-2xl shadow-sm border space-y-4">
                    <input id="form-name" class="w-full border p-3 rounded-xl outline-none focus:border-orange-500" placeholder="Ø§Ù„Ø§Ø³Ù… ÙˆØ§Ù„Ù„Ù‚Ø¨">
                    <input id="form-phone" class="w-full border p-3 rounded-xl outline-none focus:border-orange-500" placeholder="Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ">
                    <select id="form-wilaya" class="w-full border p-3 rounded-xl outline-none" onchange="updatePrices()"></select>
                    <input id="form-address" class="w-full border p-3 rounded-xl outline-none focus:border-orange-500" placeholder="Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ÙƒØ§Ù…Ù„">
                    <div class="bg-gray-100 p-2 rounded-xl flex gap-4 text-sm font-bold">
                        <label class="flex-1 text-center cursor-pointer"><input type="radio" name="del-type" value="home" checked onchange="updatePrices()"> Ù…Ù†Ø²Ù„</label>
                        <label class="flex-1 text-center cursor-pointer"><input type="radio" name="del-type" value="desk" onchange="updatePrices()"> Ù…ÙƒØªØ¨</label>
                    </div>
                    <button onclick="submitOrder()" class="w-full bg-orange-600 text-white py-4 rounded-xl font-bold">Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨</button>
                </div>
            </div>
        </div>

        <!-- ADMIN VIEW -->
        <div id="view-admin" class="view hidden space-y-6">
            <div class="bg-white p-6 rounded-2xl border max-w-lg mx-auto shadow-lg">
                <h2 class="text-xl font-bold mb-4 text-orange-600 text-center">Ù„ÙˆØ­Ø© Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</h2>
                <div class="space-y-4">
                    <input id="p-name" class="w-full border p-3 rounded-xl outline-none" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬">
                    <input id="p-price" class="w-full border p-3 rounded-xl outline-none" type="number" placeholder="Ø§Ù„Ø³Ø¹Ø±">
                    <input id="p-cat" class="w-full border p-3 rounded-xl outline-none" placeholder="Ø§Ù„ØªØµÙ†ÙŠÙ">
                    <textarea id="p-desc" class="w-full border p-3 rounded-xl outline-none" placeholder="ÙˆØµÙ Ø§Ù„Ù…Ù†ØªØ¬"></textarea>
                    <div class="border-2 border-dashed p-4 rounded-xl text-center relative">
                        <input id="p-imgs" type="file" multiple accept="image/*" class="absolute inset-0 opacity-0 cursor-pointer">
                        <p class="text-gray-400 text-sm">Ø§Ø¶ØºØ· Ù„Ø±ÙØ¹ Ø§Ù„ØµÙˆØ±</p>
                    </div>
                    <button onclick="addProduct()" id="btn-save" class="w-full bg-blue-600 text-white py-3 rounded-xl font-bold flex justify-center items-center gap-2">
                        <span>Ø­ÙØ¸ Ø§Ù„Ù…Ù†ØªØ¬</span>
                        <div id="loader" class="loader hidden"></div>
                    </button>
                </div>
            </div>
            <div id="admin-orders" class="bg-white p-6 rounded-2xl border shadow-sm space-y-4">
                <h2 class="text-xl font-bold mb-4">Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø·Ù„Ø¨Ø§Øª</h2>
                <div id="orders-list-content" class="space-y-4"></div>
            </div>
        </div>
    </main>

    <!-- PRODUCT DETAIL MODAL -->
    <div id="modal-detail" class="fixed inset-0 bg-black/80 z-[100] hidden flex items-center justify-center p-2 backdrop-blur-sm">
        <div class="bg-white w-full max-w-2xl max-h-[90vh] rounded-3xl overflow-y-auto no-scrollbar relative shadow-2xl">
            <button onclick="closeDetail()" class="absolute top-4 right-4 bg-white/80 p-2 rounded-full z-10 text-gray-800 shadow"><i data-lucide="x"></i></button>
            <div id="detail-images" class="flex overflow-x-auto snap-x snap-mandatory no-scrollbar h-80 bg-gray-100"></div>
            
            <div class="p-6 space-y-4">
                <div class="flex justify-between items-start">
                    <div>
                        <h2 id="det-name" class="text-2xl font-black"></h2>
                        <p id="det-price" class="text-xl text-orange-600 font-bold"></p>
                    </div>
                    <div class="flex flex-col items-center">
                        <button onclick="toggleLike()" id="btn-like" class="p-3 bg-red-50 text-red-500 rounded-full active:scale-90"><i data-lucide="heart"></i></button>
                        <span id="det-likes" class="text-xs font-bold text-gray-500">0</span>
                    </div>
                </div>

                <div class="flex gap-4">
                    <button onclick="openShareOptions()" class="flex-1 bg-gray-100 text-gray-700 py-3 rounded-2xl font-bold flex justify-center items-center gap-2">
                        <i data-lucide="share-2" style="width:18px"></i> Ù…Ø´Ø§Ø±ÙƒØ© Ø§Ù„Ù…Ù†ØªØ¬
                    </button>
                </div>

                <div class="border-t pt-4">
                    <h3 class="font-bold mb-2">Ø§Ù„ÙˆØµÙ</h3>
                    <p id="det-desc" class="text-sm text-gray-600 leading-relaxed"></p>
                </div>

                <div class="border-t pt-4">
                    <h3 class="font-bold mb-3">Ø§Ù„ØªØ¹Ù„ÙŠÙ‚Ø§Øª</h3>
                    <div id="det-comments" class="space-y-2 mb-4"></div>
                    <div class="flex gap-2">
                        <input id="comm-input" class="flex-1 border p-3 rounded-xl text-sm" placeholder="Ø£Ø¶Ù ØªØ¹Ù„ÙŠÙ‚...">
                        <button onclick="addComment()" class="bg-orange-600 text-white px-4 rounded-xl"><i data-lucide="send" style="width:18px"></i></button>
                    </div>
                </div>
                
                <button onclick="addToCartFromDetail()" class="w-full bg-orange-600 text-white py-4 rounded-2xl font-black text-lg shadow-lg">Ø¥Ø¶Ø§ÙØ© Ù„Ù„Ø³Ù„Ø©</button>
            </div>
        </div>
    </div>

    <!-- SHARE OPTIONS MODAL -->
    <div id="modal-share" class="fixed inset-0 bg-black/60 z-[110] hidden flex items-center justify-center p-4">
        <div class="bg-white w-full max-w-xs p-6 rounded-3xl shadow-2xl text-center space-y-4">
            <h3 class="font-black text-xl">Ù…Ø´Ø§Ø±ÙƒØ© Ø§Ù„Ù…Ù†ØªØ¬</h3>
            <div class="grid grid-cols-2 gap-4">
                <button onclick="doShare('fb')" class="flex flex-col items-center gap-2">
                    <div class="bg-blue-600 p-4 rounded-full text-white"><i data-lucide="facebook"></i></div>
                    <span class="text-xs font-bold">Facebook</span>
                </button>
                <button onclick="doShare('wa')" class="flex flex-col items-center gap-2">
                    <div class="bg-green-500 p-4 rounded-full text-white"><i data-lucide="message-circle"></i></div>
                    <span class="text-xs font-bold">WhatsApp</span>
                </button>
            </div>
            <button onclick="doShare('copy')" class="w-full bg-gray-100 py-3 rounded-xl text-sm font-bold">Ù†Ø³Ø® Ø§Ù„Ø±Ø§Ø¨Ø·</button>
            <button onclick="document.getElementById('modal-share').classList.add('hidden')" class="text-gray-400 text-sm">Ø¥ØºÙ„Ø§Ù‚</button>
        </div>
    </div>

    <!-- ADMIN LOGIN MODAL -->
    <div id="modal-login" class="fixed inset-0 bg-black/80 z-[120] flex items-center justify-center hidden p-4">
        <div class="bg-white p-8 rounded-3xl w-full max-w-sm shadow-2xl text-center">
            <h2 class="text-2xl font-black mb-6">Admin Login</h2>
            <input id="login-pass" type="password" class="w-full border-2 p-4 rounded-2xl mb-4 text-center tracking-widest text-2xl outline-orange-500" placeholder="â€¢â€¢â€¢â€¢â€¢">
            <button onclick="handleLogin()" class="w-full bg-orange-600 text-white py-4 rounded-2xl font-black text-lg">Ø¯Ø®ÙˆÙ„</button>
        </div>
    </div>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyANZmMR3E5-QnkO-SgIY3yv5i2n7AciLkU",
            authDomain: "achri-822f1.firebaseapp.com",
            databaseURL: "https://achri-822f1-default-rtdb.europe-west1.firebasedatabase.app",
            projectId: "achri-822f1",
            storageBucket: "achri-822f1.firebasestorage.app",
            messagingSenderId: "1067421301667",
            appId: "1:1067421301667:web:e1a47b79e2911c6d17b816"
        };

        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        let allProducts = [];
        let cart = [];
        let lang = 'ar';
        let currentPId = null;
        let holdTimer;
        const wilayas = ["01 Adrar", "02 Chlef", "03 Laghouat", "04 Oum El Bouaghi", "05 Batna", "06 Bejaia", "07 Biskra", "08 Bechar", "09 Blida", "10 Bouira", "11 Tamanrasset", "12 Tebessa", "13 Tlemcen", "14 Tiaret", "15 Tizi Ouzou", "16 Alger", "17 Djelfa", "18 Jijel", "19 Setif", "20 Saida", "21 Skikda", "22 Sidi Bel Abbes", "23 Annaba", "24 Guelma", "25 Constantine", "26 Medea", "27 Mostaganem", "28 M'Sila", "29 Mascara", "30 Ouargla", "31 Oran", "32 El Bayadh", "33 Illizi", "34 Bordj Bou Arreridj", "35 Boumerdes", "36 El Tarf", "37 Tindouf", "38 Tissemsilt", "39 El Oued", "40 Khenchela", "41 Souk Ahras", "42 Tipaza", "43 Mila", "44 Ain Defla", "45 Naama", "46 Ain Temouchent", "47 Ghardaia", "48 Relizane", "49 El M'Ghair", "50 El Meniaa", "51 Ouled Djellal", "52 Bordj Baji Mokhtar", "53 Beni Abbes", "54 Timimoun", "55 Touggourt", "56 Djanet", "57 In Salah", "58 In Guezzam"];

        window.onload = () => {
            initWilayas();
            loadProducts();
            setupSecretAdmin();
            lucide.createIcons();
        };

        // --- DATABASE LOGIC ---
        function loadProducts() {
            db.ref('products').on('value', snap => {
                const data = snap.val();
                allProducts = data ? Object.keys(data).map(k => ({id:k, ...data[k]})) : [];
                renderProducts();
                renderCategories();
                if(currentPId) updateDetailView(data[currentPId]);
            });
        }

        function renderProducts(list = allProducts) {
            const grid = document.getElementById('product-grid');
            grid.innerHTML = list.map(p => `
                <div onclick="openDetail('${p.id}')" class="product-card bg-white rounded-2xl border shadow-sm overflow-hidden">
                    <img src="${p.images[0]}" class="w-full aspect-square object-cover bg-gray-50 pointer-events-none">
                    <div class="p-3 pointer-events-none">
                        <h3 class="font-bold text-sm truncate">${p.name}</h3>
                        <p class="text-orange-600 font-black">${p.price} DA</p>
                        <div class="flex justify-between items-center mt-2 text-[10px] text-gray-400 font-bold">
                           <span><i data-lucide="heart" class="inline w-3 h-3 ${localStorage.getItem('liked_'+p.id)?'liked':''}"></i> ${p.likes || 0}</span>
                           <span>${p.category}</span>
                        </div>
                    </div>
                </div>
            `).join('');
            lucide.createIcons();
        }

        // --- PRODUCT DETAIL ---
        function openDetail(id) {
            currentPId = id;
            const p = allProducts.find(x => x.id === id);
            if(!p) return;
            document.getElementById('modal-detail').classList.remove('hidden');
            updateDetailView(p);
            if(localStorage.getItem('liked_'+id)) document.getElementById('btn-like').classList.add('liked');
            else document.getElementById('btn-like').classList.remove('liked');
        }

        function updateDetailView(p) {
            if(!p) return;
            document.getElementById('det-name').innerText = p.name;
            document.getElementById('det-price').innerText = p.price + " DA";
            document.getElementById('det-desc').innerText = p.description || "Ù„Ø§ ÙŠÙˆØ¬Ø¯ ÙˆØµÙ";
            document.getElementById('det-likes').innerText = p.likes || 0;
            document.getElementById('detail-images').innerHTML = p.images.map(img => `<img src="${img}" class="h-full w-full object-cover snap-center shrink-0">`).join('');
            const comms = p.comments ? Object.values(p.comments).reverse() : [];
            document.getElementById('det-comments').innerHTML = comms.map(c => `<div class="bg-gray-50 p-2 rounded-xl text-xs border border-gray-100"><p class="text-gray-600">${c.text}</p></div>`).join('');
            lucide.createIcons();
        }

        function closeDetail() { document.getElementById('modal-detail').classList.add('hidden'); currentPId = null; }

        function toggleLike() {
            const key = 'liked_' + currentPId;
            if(localStorage.getItem(key)) return alert("Ù„Ù‚Ø¯ Ø£Ø¹Ø¬Ø¨Øª Ø¨Ù‡ Ù…Ø³Ø¨Ù‚Ø§Ù‹");
            db.ref('products/' + currentPId + '/likes').transaction(c => (c || 0) + 1);
            localStorage.setItem(key, 'true');
            document.getElementById('btn-like').classList.add('liked');
        }

        // --- SHARING ---
        function openShareOptions() { document.getElementById('modal-share').classList.remove('hidden'); }
        function doShare(type) {
            const url = window.location.href;
            const p = allProducts.find(x => x.id === currentPId);
            const txt = `Ø§ÙƒØªØ´Ù Ù‡Ø°Ø§ Ø§Ù„Ù…Ù†ØªØ¬: ${p.name} Ø¹Ù„Ù‰ Achri!`;
            if(type === 'fb') window.open(`https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(url)}`);
            if(type === 'wa') window.open(`https://api.whatsapp.com/send?text=${encodeURIComponent(txt + " " + url)}`);
            if(type === 'copy') { navigator.clipboard.writeText(url); alert("ØªÙ… Ø§Ù„Ù†Ø³Ø®!"); }
            document.getElementById('modal-share').classList.add('hidden');
        }

        // --- CART & ORDERS ---
        function addToCartFromDetail() {
            cart.push(allProducts.find(x => x.id === currentPId));
            document.getElementById('cart-count').innerText = cart.length;
            renderCartUI();
            closeDetail();
            alert("ØªÙ…Øª Ø§Ù„Ø¥Ø¶Ø§ÙØ©!");
        }

        function renderCartUI() {
            document.getElementById('cart-items').innerHTML = cart.map((p, i) => `<div class="flex justify-between py-2 text-xs"><span>${p.name}</span><b>${p.price} DA</b></div>`).join('');
            updatePrices();
        }

        function updatePrices() {
            const sub = cart.reduce((s, p) => s + parseInt(p.price), 0);
            const del = document.querySelector('input[name="del-type"]:checked').value === 'home' ? 600 : 400;
            document.getElementById('shipping-price').innerText = del + " DA";
            document.getElementById('total-price').innerText = (sub + del) + " DA";
        }

        async function submitOrder() {
            const name = document.getElementById('form-name').value;
            const phone = document.getElementById('form-phone').value;
            if(!name || !phone || cart.length === 0) return alert("Ø¨ÙŠØ§Ù†Ø§Øª Ù†Ø§Ù‚ØµØ©");
            const total = document.getElementById('total-price').innerText;
            await db.ref('orders').push({
                customer: name, phone, wilaya: document.getElementById('form-wilaya').value,
                items: cart.map(i => i.name), total, status: "Ù‚ÙŠØ¯ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±", date: new Date().toLocaleString()
            });
            alert("ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø·Ù„Ø¨Ùƒ! Ø§Ù„Ø³Ø¹Ø± Ø§Ù„ÙƒÙ„ÙŠ: " + total);
            cart = []; location.reload();
        }

        // --- ADMIN SECRETS ---
        function setupSecretAdmin() {
            const logo = document.getElementById('logo');
            const progress = document.getElementById('hold-progress');
            const startHold = (e) => {
                e.preventDefault();
                logo.classList.add('hold-active');
                progress.style.width = '100%';
                holdTimer = setTimeout(() => {
                    document.getElementById('modal-login').classList.remove('hidden');
                    resetHold();
                }, 3000);
            };
            const resetHold = () => {
                clearTimeout(holdTimer);
                logo.classList.remove('hold-active');
                progress.style.transition = 'none';
                progress.style.width = '0%';
                setTimeout(() => progress.style.transition = 'width 3s linear', 10);
            };
            logo.addEventListener('mousedown', startHold);
            logo.addEventListener('touchstart', startHold);
            window.addEventListener('mouseup', resetHold);
            window.addEventListener('touchend', resetHold);
        }

        function handleLogin() {
            if(document.getElementById('login-pass').value === '12346') {
                document.getElementById('modal-login').classList.add('hidden');
                document.getElementById('admin-nav-btn').classList.remove('hidden');
                showView('admin');
            } else alert("Ø®Ø·Ø£!");
        }

        async function addProduct() {
            const name = document.getElementById('p-name').value;
            const price = document.getElementById('p-price').value;
            const files = document.getElementById('p-imgs').files;
            if(!name || !price || files.length === 0) return alert("Ù†Ù‚Øµ Ø¨ÙŠØ§Ù†Ø§Øª");
            const btn = document.getElementById('btn-save');
            const loader = document.getElementById('loader');
            btn.disabled = true; loader.classList.remove('hidden');
            const imgs = [];
            for(let f of files) { imgs.push(await compressImg(f)); }
            await db.ref('products').push({ name, price, category: document.getElementById('p-cat').value || 'Ø¹Ø§Ù…', description: document.getElementById('p-desc').value, images: imgs, likes: 0 });
            alert("ØªÙ…!"); location.reload();
        }

        function loadOrders() {
            db.ref('orders').on('value', snap => {
                const data = snap.val();
                const list = data ? Object.values(data).reverse() : [];
                document.getElementById('orders-list-content').innerHTML = list.map(o => {
                    let statusClass = o.status === "ØªÙ… Ø§Ù„ØªÙˆØµÙŠÙ„" ? "status-delivered" : (o.status === "Ù‚ÙŠØ¯ Ø§Ù„Ø´Ø­Ù†" ? "status-shipped" : "status-pending");
                    return `
                    <div class="p-4 border rounded-2xl bg-white shadow-sm space-y-2">
                        <div class="flex justify-between items-center">
                            <span class="px-3 py-1 rounded-full text-[10px] font-black ${statusClass}">${o.status || "Ù‚ÙŠØ¯ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±"}</span>
                            <span class="text-orange-600 font-black">${o.total}</span>
                        </div>
                        <p class="font-bold">${o.customer} (${o.phone})</p>
                        <p class="text-xs text-gray-500">${o.wilaya} | ${o.date}</p>
                        <p class="text-xs text-blue-600 font-bold italic">ğŸ“¦ ${o.items.join(', ')}</p>
                    </div>
                `}).join('');
            });
        }

        // --- HELPERS ---
        function compressImg(file) {
            return new Promise(res => {
                const r = new FileReader(); r.readAsDataURL(file);
                r.onload = e => {
                    const img = new Image(); img.src = e.target.result;
                    img.onload = () => {
                        const canvas = document.createElement('canvas'); const ctx = canvas.getContext('2d');
                        canvas.width = 400; canvas.height = img.height * (400 / img.width);
                        ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
                        res(canvas.toDataURL('image/jpeg', 0.7));
                    }
                }
            });
        }

        function showView(v) {
            document.querySelectorAll('.view').forEach(el => el.classList.add('hidden'));
            document.getElementById('view-' + v).classList.remove('hidden');
            if(v === 'admin') loadOrders();
            window.scrollTo(0,0);
        }

        function initWilayas() { document.getElementById('form-wilaya').innerHTML = wilayas.map(w => `<option>${w}</option>`).join(''); }

        function renderCategories() {
            const cats = ['All', ...new Set(allProducts.map(p => p.category))];
            document.getElementById('category-bar').innerHTML = cats.map(c => `<button onclick="renderProducts(allProducts.filter(p => '${c}' === 'All' || p.category === '${c}'))" class="bg-white border px-4 py-1 rounded-full text-xs font-bold whitespace-nowrap shadow-sm">${c}</button>`).join('');
        }

        function toggleLang() {
            lang = lang === 'ar' ? 'en' : 'ar';
            document.dir = lang === 'ar' ? 'rtl' : 'ltr';
            document.getElementById('lang-btn').innerText = lang === 'ar' ? 'English' : 'Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©';
            document.getElementById('t-cart').innerText = lang === 'ar' ? 'Ø³Ù„Ø© Ø§Ù„ØªØ³ÙˆÙ‚' : 'Shopping Cart';
        }
    </script>
</body>
</html>